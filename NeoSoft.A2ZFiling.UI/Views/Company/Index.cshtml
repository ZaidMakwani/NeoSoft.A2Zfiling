@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
@model IEnumerable<NeoSoft.A2ZFiling.UI.ViewModels.CompanyVM>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AdminLTE 3 | CompanyNames</title>

    <!-- Google Font: Source Sans Pro -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="~/plugins/fontawesome-free/css/all.min.css" />
    <!-- DataTables -->
    <link rel="stylesheet" href="~/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="~/plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
    <link rel="stylesheet" href="~/plugins/datatables-buttons/css/buttons.bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-modal/2.2.6/js/bootstrap-modalmanager.min.js">
    <!-- Theme style -->
    <link rel="stylesheet" href="~/dist/css/adminlte.min.css">
</head>
<body class="hold-transition sidebar-mini">
    <div class="wrapper">
        <section class="content m-5 ">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-12">
                        <div class="row justify-content-end">
                            <div class="col-lg-10">
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">Companies</h3>
                                        <div class="card-tools">

                                            <div id="placeholder"></div>
                                            <button type="button" class="btn btn-primary" data-toggle="ajax-modal" data-target="#createModal"
                                                    data-url="@Url.Action("Create", "Company")">
                                                <i class="fas fa-plus"></i> Create
                                            </button>
                                        </div>

                                        @*  <a asp-action="Create" asp-controller="Company" class="btn btn-primary">
                                        <i class="fas fa-plus"></i> Create
                                        </a> *@


                                    </div>

                                </div>
                                <!-- /.card-header -->
                                <div class="card-body">
                                    <table id="example2" class="table table-bordered table-hover">
                                        <thead>
                                            <tr>
                                                @*  <th>Rendering engine</th>
                                                <th>Browser</th> *@
                                                <th>Id</th>
                                                <th>CompanyName</th>
                                                <th>ShortName</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>

                                        <tbody>

                                            @foreach (var item in Model)
                                            {
                                                <tr>
                                                    @* <td>Trident</td>
                                                <td>
                                                Internet
                                                @*   Explorer 4.0
                                                </td> *@
                                                    <input type="hidden" class="company-id" value="@item.CompanyId" />
                                                    <td>@Html.DisplayFor(modelItem => item.CompanyId)</td>
                                                    <td>@Html.DisplayFor(modelItem => item.CompanyName)</td>
                                                    <td>@Html.DisplayFor(modelItem => item.ShortName)</td>
                                                    <td>
                                                        @* <a class="btn btn-primary btn-sm" asp-action="Update" asp-controller="Company" asp-route-id="@item.CompanyId">

                                                            <i class="fas fa-edit"></i> @* Edit
                                                        </a> *@
                                                        <a class="btn btn-primary btn-sm edit-button" data-toggle="ajax-modal" data-target="#updateModal"
                                                                data-url="@Url.Action("Update", "Company")" data-id="@item.CompanyId">
                                                            <i class="fas fa-edit"></i> 
                                                        </a>

                                                        <button id="triggerModalButton" class="btn btn-danger btn-sm trigger-modal">
                                                            <i class="fas fa-trash-alt"></i>@* Delete  *@
                                                        </button>

                                                    </td>

                                                </tr>
                                            }


                                        </tbody>

                                    </table>
                                </div>
                                <!-- /.card-body -->
                            </div>
                        </div>
                    </div>

                </div>
                <!-- /.col -->
            </div>
            <!-- /.row -->
    </div>
    <!-- /.container-fluid -->
    </section>

    <div id="myModal" class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirm Deletion</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this item?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger delete-item">Delete</button>
                    @* <button type="button" class="btn btn-danger delete-item" data-url="@Url.Action("Delete", "Company", new { id = item.CompanyId })">Delete</button> *@

                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Control Sidebar -->
    <aside class="control-sidebar control-sidebar-dark">
        <!-- Control sidebar content goes here -->
    </aside>
    <!-- /.control-sidebar -->
    </div>
    <!-- ./wrapper -->
    <!-- jQuery -->
    <script src="~/plugins/jquery/jquery.min.js"></script>
    <!-- Bootstrap 4 -->
    <script src="~/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- DataTables  & Plugins -->
    <script src="~/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="~/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="~/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
    <script src="~/plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
    <script src="~/plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
    <script src="~/plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
    <script src="~/plugins/jszip/jszip.min.js"></script>
    <script src="~/plugins/pdfmake/pdfmake.min.js"></script>
    <script src="~/plugins/pdfmake/vfs_fonts.js"></script>
    <script src="~/plugins/datatables-buttons/js/buttons.html5.min.js"></script>
    <script src="~/plugins/datatables-buttons/js/buttons.print.min.js"></script>
    <script src="~/plugins/datatables-buttons/js/buttons.colVis.min.js"></script>
    <!-- AdminLTE App -->
    <script src="~/dist/js/adminlte.min.js"></script>
    <!-- AdminLTE for demo purposes -->
    <script src="~/dist/js/demo.js"></script>
    <!-- Page specific script -->
    <script>
        $(function () {
            $("#example1").DataTable({
                "responsive": true, "lengthChange": false, "autoWidth": false,
                "buttons": ["copy", "csv", "excel", "pdf", "print", "colvis"]
            }).buttons().container().appendTo('#example1_wrapper .col-md-6:eq(0)');
            $('#example2').DataTable({
                "paging": true,
                "pageLength": 4,
                "lengthChange": false,
                "searching": false,
                "ordering": true,
                "info": true,
                "autoWidth": false,
                "responsive": true,
            });
        });

        function showModal() {
            document.getElementById('myModal').style.display = 'block';
        }

        // Function to hide the modal when the close button is clicked
        function closeModal() {
            document.getElementById('myModal').style.display = 'none';
        }

        // Add event listeners to trigger the modal and close it
        document.querySelectorAll('.trigger-modal').forEach(button => {
            button.addEventListener('click', () => {
                // Show the modal
                showModal();
            });
        });

        document.querySelectorAll('[data-dismiss="modal"]').forEach(button => {
            button.addEventListener('click', () => {
                // Close the modal
                closeModal();
            });
        });

        // Handle delete button click inside the modal
        document.querySelector('.delete-item').addEventListener('click', () => {
            // Perform delete operation here
            // For demonstration purpose, let's log a message
            console.log('Item deleted');

            // Close the modal
            closeModal();
        });







        //function to handle create modal

        $(function () {
            var card = $('#placeholder');

            $('button[data-toggle="ajax-modal"]').click(function (event) {
                var url = $(this).data('url');
                var decodeUrl = decodeURIComponent(url);
                $.get(decodeUrl).done(function (data) {
                    card.html(data);
                    card.find('.modal').modal('show');

                    // Unbind previously bound event handler
                    card.off('click', '[data-save="modal"]');

                    // Event delegation for dynamically loaded content
                    card.on('click', '[data-save="modal"]', function (event) {
                        var form = $(this).parents('.modal').find('form');
                        var actionUrl = form.attr('action');
                        var url = '@Url.Action("Create", "Company")';
                        var sendData = form.serialize();

                        $.post(url, sendData).done(function (data) {

                            card.find('.modal').modal('hide');

                        }).fail(function (xhr, status, error) {
                            var errorMessage = xhr.responseText;
                            console.log(errorMessage);
                            // Update the modal content to display the error message
                            card.find('.modal-body').prepend('<div class="alert alert-danger" role="alert">' + errorMessage + '</div>');
                        });
                    });
                });
            });
        });

         





        //function to handle editzone in the modal




        $(document).on('click', '.edit-button', function () {

            var CompanyId = $(this).data("id");
            var editUrl = '@Url.Action("Update", "Company")' + '?id=' + CompanyId;

            // AJAX request to fetch data for editing
            $.ajax({
                url: editUrl,
                type: 'GET',
                success: function (data) {
                    // Load the partial view into the placeholder div
                    $('#placeholder').html(data);
                    // Show the edit modal
                    $('#updateModal').modal('show');
                },
                error: function (xhr, status, error) {
                    console.error("Error fetching Company data: ", error);
                    alert("Error fetching Company data. Please try again.");
                }
            });
        });


        // Function to update data after saving
        function updateData() {
            var CompanyId = $('#CompanyId').val(); // Assuming you have a hidden input field with the CompanyId
            var editUrl = '@Url.Action("Update", "Company")' + '?id=' + CompanyId;

            // AJAX request to fetch updated data
            $.ajax({
                url: editUrl,
                type: 'GET',
                success: function (data) {
                    // Replace the content in the placeholder div with the updated data
                    $('#placeholder').html(data);
                    // Close the modal or perform any other action as needed
                    // alert('Company Updated successfully');

                    $('#updateModal').modal('hide');
                },
                error: function (xhr, status, error) {
                    console.error("Error fetching updated Company data: ", error);
                    alert("Error fetching updated Company data. Please try again.");
                }
            });
        }

        $(document).on('click', '#saveButton', function () {

            // Perform validation and submit data via AJAX
            $.ajax({
                url: '@Url.Action("Update", "Company")',
                type: 'POST',
                data: $('#updateCompanyForm').serialize(),
                success: function (response) {
                    console.log(response);
                    // Check if the response indicates success
                    if (response) {
                        updateData(); // Call function to update data
                        alert('Zone Updated successfully');
                        $('#updateModal').modal('hide');
                    }
                    else {
                        alert("An error occurred while saving data. Please try again.");
                    }
                },
                error: function (xhr, status, error) {
                    // Display more detailed error message from server response
                    var errorMessage = xhr.responseText;
                    if (errorMessage) {
                        var errorHtml = '<div class="alert alert-danger" role="alert">' + errorMessage + '</div>';
                        $('#updateModal .modal-body').prepend(errorHtml); // Prepend error message to modal body
                    } else {
                        alert("An error occurred while saving data. Please try again.");
                    }
                }
            });
        });



        $(document).on('click', '#closeButton, .close', function () {
            // Close the modal
            $('#updateModal').modal('hide');
        });




    </script>
</body>